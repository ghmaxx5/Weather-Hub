<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Weather Hub - Indian Cities Weather App</title>
<meta name="description" content="Get real-time weather information for Indian cities with beautiful animations and sound effects" />

<!-- PWA Configuration -->
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#4facfe" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="Weather Hub" />

<!-- Google AdSense Verification & Funding Choices -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1401210538981315"
     crossorigin="anonymous"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-1401210538981315",
    enable_page_level_ads: true,
    overlays: {bottom: true}
  });
</script>
<meta name="google-adsense-account" content="ca-pub-1401210538981315">

<!-- Icons -->
<link rel="apple-touch-icon" href="icons/icon-192x192.png" />
<link rel="icon" type="image/png" href="icons/icon-192x192.png" />

<!-- Open Graph tags for social media sharing -->
<meta property="og:title" content="Weather Hub - Indian Cities Weather App" />
<meta property="og:description" content="Get real-time weather information for Indian cities with beautiful animations and sound effects" />
<meta property="og:type" content="website" />
<meta property="og:image" content="/icons/icon-512x512.png" />

<!-- Google AdSense -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1401210538981315"
     crossorigin="anonymous"></script>
<meta name="google-adsense-account" content="ca-pub-1401210538981315">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
* { 
  margin: 0; 
  padding: 0; 
  box-sizing: border-box; 
}

body { 
  min-height: 100vh; 
  display: flex; 
  justify-content: center; 
  align-items: flex-start; 
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  font-family: 'Inter', 'Poppins', sans-serif;
  color: #fff; 
  overflow-x: hidden;
  overflow-y: auto;
  position: relative;
  transition: all 1s cubic-bezier(0.4, 0, 0.2, 1);
  padding: 20px 0;
}

/* Optimized container - positioned behind rain */
.container { 
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.3);
  padding: 30px 25px;
  border-radius: 24px;
  box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15), 0 0 100px rgba(255, 255, 255, 0.08);
  max-width: 420px;
  width: 90%;
  text-align: center;
  position: relative;
  z-index: 5;
  animation: containerFloat 6s ease-in-out infinite;
  margin: 20px auto;
  max-height: 90vh;
  overflow-y: auto;
}

@keyframes containerFloat {
  0%, 100% { transform: translateY(0px) scale(1); }
  50% { transform: translateY(-10px) scale(1.02); }
}

h1 { 
  margin-bottom: 30px; 
  font-size: 2.8rem; 
  font-weight: 700;
  background: linear-gradient(135deg, #fff 0%, #a8edea 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-shadow: 0 4px 20px rgba(255, 255, 255, 0.3);
  letter-spacing: -1px;
  animation: titlePulse 4s ease-in-out infinite;
}

@keyframes titlePulse {
  0%, 100% { filter: brightness(1); }
  50% { filter: brightness(1.2); }
}

.search-container {
  position: relative;
  width: 100%;
  margin-bottom: 20px;
}

input { 
  padding: 16px 20px;
  border-radius: 16px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  background: rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(8px);
  outline: none;
  width: 100%;
  font-size: 1.1rem;
  color: #fff;
  font-weight: 500;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 10px 35px rgba(0, 0, 0, 0.12);
}

input::placeholder {
  color: rgba(255, 255, 255, 0.7);
  font-weight: 400;
}

input:focus {
  border-color: rgba(255, 255, 255, 0.5);
  background: rgba(255, 255, 255, 0.2);
  transform: translateY(-2px);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
}

#searchBtn { 
  padding: 16px 32px;
  margin-top: 16px;
  border: none;
  border-radius: 16px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  font-weight: 600;
  font-size: 1.1rem;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(102, 126, 234, 0.4);
  position: relative;
  overflow: hidden;
}

#searchBtn:hover { 
  transform: translateY(-3px);
  box-shadow: 0 12px 40px rgba(102, 126, 234, 0.6);
}

#searchBtn:active {
  transform: translateY(-1px);
}

.weather-card { 
  margin-top: 30px;
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(10px);
  padding: 30px;
  border-radius: 20px;
  border: 1px solid rgba(255, 255, 255, 0.3);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
  animation: cardSlideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes cardSlideIn {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

.weather-card h2 {
  font-size: 2.2rem;
  font-weight: 600;
  margin-bottom: 15px;
  color: #fff;
  text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

.weather-card p { 
  margin: 12px 0;
  font-size: 1.2rem;
  font-weight: 500;
  opacity: 0.9;
  line-height: 1.6;
}

#suggestions { 
  position: absolute;
  top: 100%;
  left: 0;
  width: 100%;
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  max-height: 200px;
  overflow-y: auto;
  display: none;
  z-index: 30;
  margin-top: 8px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

#suggestions div { 
  padding: 14px 18px;
  cursor: pointer;
  transition: all 0.2s ease;
  font-weight: 500;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

#suggestions div:hover { 
  background: rgba(255, 255, 255, 0.25);
  transform: translateX(4px);
}

#suggestions div:last-child {
  border-bottom: none;
}

/* Enhanced Weather Animations */
.particles { 
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 1;
}

.clouds { 
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 2;
}

.cloud { 
  position: absolute;
  background: radial-gradient(ellipse at center, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0.4) 40%, transparent 70%);
  border-radius: 50px;
  animation: moveClouds linear infinite;
  filter: blur(2px);
}

.cloud::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 20%;
  width: 50%;
  height: 80%;
  background: radial-gradient(ellipse, rgba(255,255,255,0.6) 0%, transparent 70%);
  border-radius: 50px;
  transform: translateY(-50%);
}

.cloud::after {
  content: '';
  position: absolute;
  top: 30%;
  right: 20%;
  width: 60%;
  height: 60%;
  background: radial-gradient(ellipse, rgba(255,255,255,0.5) 0%, transparent 70%);
  border-radius: 50px;
}

@keyframes moveClouds { 
  0% { transform: translateX(-200px); opacity: 0; }
  10% { opacity: 1; }
  90% { opacity: 1; }
  100% { transform: translateX(calc(100vw + 200px)); opacity: 0; }
}

.rain { 
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 20;
}

.rain-drop { 
  position: absolute;
  width: 1.5px;
  background: linear-gradient(to bottom, 
    rgba(220, 240, 255, 0.1) 0%,
    rgba(180, 210, 240, 0.4) 20%,
    rgba(160, 200, 230, 0.7) 60%, 
    rgba(140, 180, 210, 0.9) 100%);
  border-radius: 1px;
  animation: fall linear infinite;
  box-shadow: 0 0 2px rgba(180, 210, 240, 0.3);
  filter: blur(0.3px);
}

@keyframes fall { 
  0% { 
    transform: translateY(-100vh) rotate(10deg);
    opacity: 1;
  }
  100% { 
    transform: translateY(100vh) rotate(10deg);
    opacity: 0;
  }
}

.sun { 
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, #FFD700, #FFA500, #FF6347);
  position: absolute;
  top: 80px;
  right: 80px;
  box-shadow: 
    0 0 60px #FFD700,
    0 0 120px #FFA500,
    0 0 180px rgba(255, 215, 0, 0.4);
  animation: rotateSun 20s linear infinite;
  z-index: 1;
}

.sun::before {
  content: '';
  position: absolute;
  top: -40px;
  left: -40px;
  right: -40px;
  bottom: -40px;
  background: 
    conic-gradient(from 0deg, transparent, #FFD700, transparent, #FFD700, transparent, #FFD700, transparent, #FFD700, transparent);
  border-radius: 50%;
  animation: rotateSunRays 15s linear infinite reverse;
  opacity: 0.6;
}

@keyframes rotateSun { 
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes rotateSunRays { 
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.snowflake {
  position: absolute;
  color: #fff;
  font-size: 1em;
  animation: snowfall linear infinite;
  text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
}

@keyframes snowfall {
  0% {
    transform: translateY(-100vh) rotate(0deg);
    opacity: 1;
  }
  100% {
    transform: translateY(100vh) rotate(360deg);
    opacity: 0;
  }
}

.lightning-flash { 
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    radial-gradient(ellipse 150% 100% at 50% 0%, rgba(200, 220, 255, 0.8) 0%, rgba(255, 255, 255, 0.6) 30%, transparent 60%),
    linear-gradient(135deg, rgba(150, 200, 255, 0.4) 0%, rgba(255, 255, 255, 0.3) 50%, transparent 100%);
  opacity: 0;
  z-index: 25;
  pointer-events: none;
  transition: opacity 0.05s ease;
  filter: brightness(1.5);
}

.fog {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    radial-gradient(ellipse at top, rgba(255, 255, 255, 0.3) 0%, transparent 70%),
    radial-gradient(ellipse at bottom, rgba(255, 255, 255, 0.2) 0%, transparent 50%);
  animation: fogMove 8s ease-in-out infinite;
  pointer-events: none;
  z-index: 4;
}

@keyframes fogMove {
  0%, 100% { opacity: 0.6; transform: translateX(-10px); }
  50% { opacity: 0.8; transform: translateX(10px); }
}

/* Responsive Design */
@media (max-width: 480px) {
  .container {
    padding: 30px 20px;
    width: 95%;
  }
  
  h1 {
    font-size: 2.2rem;
  }
  
  .sun {
    width: 80px;
    height: 80px;
    top: 60px;
    right: 40px;
  }
}

/* Loading animation */
.loading {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: #fff;
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Ad Styling */
.ad-container {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(8px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 12px;
  padding: 12px;
  margin: 15px 0;
  text-align: center;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  position: relative;
  z-index: 6;
}

.ad-label {
  font-size: 0.7rem;
  color: rgba(255, 255, 255, 0.6);
  margin-bottom: 8px;
  text-transform: uppercase;
  letter-spacing: 1px;
  font-weight: 500;
}

.banner-ad {
  min-height: 70px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.square-ad {
  min-height: 200px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.native-ad {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  padding: 12px;
  margin: 10px 0;
}

/* Ad responsive design */
@media (max-width: 480px) {
  .container {
    padding: 25px 20px;
    margin: 10px auto;
    max-height: 95vh;
  }
  
  .ad-container {
    margin: 10px 0;
    padding: 10px;
  }
  
  .banner-ad {
    min-height: 60px;
  }
  
  .square-ad {
    min-height: 150px;
  }
  
  body {
    padding: 10px 0;
  }
}
</style>
</head>
<body>
<div class="container">
  <h1>Weather Hub</h1>
  
    <!-- Top Banner Ad -->
    <div class="ad-container">
      <div class="ad-label">Advertisement</div>
      <div class="banner-ad">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-1401210538981315"
             data-ad-slot="6775373820"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      </div>
    </div>

  <div class="search-container">
    <input type="text" id="cityInput" placeholder="üåç Enter Indian city name..." autocomplete="off">
    <div id="suggestions"></div>
  </div>
  <button id="searchBtn" onclick="getWeather()">üîç Get Weather</button>

  <div id="weatherResult" class="weather-card" style="display:none;">
    <h2 id="cityName"></h2>
    <p id="description"></p>
    <p id="temperature"></p>
    <p id="wind"></p>
    <p id="humidity"></p>
    
    <!-- Native Ad within weather card -->
    <div class="native-ad">
      <div class="ad-label">Sponsored</div>
      <ins class="adsbygoogle"
           style="display:block; text-align:center;"
           data-ad-layout="in-article"
           data-ad-format="fluid"
           data-ad-client="ca-pub-1401210538981315"
           data-ad-slot="9330875667"></ins>
      <script>
           (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
  </div>
  
  <!-- Bottom Square/Rectangle Ad -->
  <div class="ad-container">
    <div class="ad-label">Advertisement</div>
    <div class="square-ad">
      <ins class="adsbygoogle"
           style="display:block; text-align:center;"
           data-ad-layout="in-article"
           data-ad-format="fluid"
           data-ad-client="ca-pub-1401210538981315"
           data-ad-slot="9330875667"></ins>
      <script>
           (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
  </div>
</div>

<div class="particles" id="particles"></div>
<div class="clouds" id="clouds"></div>
<div class="rain" id="rain"></div>
<div class="sun" id="sun" style="display:none;"></div>
<div class="lightning-flash" id="flash"></div>
<div class="fog" id="fog" style="display:none;"></div>

<script>
// ---------- Enhanced Audio System ----------
let audioCtx = null, rainNode = null, rainGain = null, windNode = null, windGain = null;

function initAudio() {
  if (audioCtx) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  // Enhanced rain sound
  const rainBuf = audioCtx.createBuffer(1, audioCtx.sampleRate * 2, audioCtx.sampleRate);
  const rainData = rainBuf.getChannelData(0);
  for (let i = 0; i < rainData.length; i++) {
    rainData[i] = (Math.random() * 2 - 1) * 0.25;
  }

  const rainSrc = audioCtx.createBufferSource();
  rainSrc.buffer = rainBuf;
  rainSrc.loop = true;
  const rainLp = audioCtx.createBiquadFilter();
  rainLp.type = 'lowpass';
  rainLp.frequency.value = 1200;
  rainGain = audioCtx.createGain();
  rainGain.gain.value = 0;
  rainSrc.connect(rainLp).connect(rainGain).connect(audioCtx.destination);
  rainSrc.start();
  rainNode = rainSrc;

  // Wind sound
  const windBuf = audioCtx.createBuffer(1, audioCtx.sampleRate * 3, audioCtx.sampleRate);
  const windData = windBuf.getChannelData(0);
  for (let i = 0; i < windData.length; i++) {
    windData[i] = (Math.random() * 2 - 1) * 0.2 * Math.sin(i * 0.001);
  }

  const windSrc = audioCtx.createBufferSource();
  windSrc.buffer = windBuf;
  windSrc.loop = true;
  const windLp = audioCtx.createBiquadFilter();
  windLp.type = 'lowpass';
  windLp.frequency.value = 800;
  windGain = audioCtx.createGain();
  windGain.gain.value = 0;
  windSrc.connect(windLp).connect(windGain).connect(audioCtx.destination);
  windSrc.start();
  windNode = windSrc;
}

function playRain(intensity = 0.3) {
  if (!audioCtx) initAudio();
  rainGain.gain.setTargetAtTime(intensity, audioCtx.currentTime, 0.5);
}

function stopRain() {
  if (!audioCtx) return;
  rainGain.gain.setTargetAtTime(0, audioCtx.currentTime, 0.5);
}

function playWind(intensity = 0.15) {
  if (!audioCtx) initAudio();
  windGain.gain.setTargetAtTime(intensity, audioCtx.currentTime, 0.8);
}

function stopWind() {
  if (!audioCtx) return;
  windGain.gain.setTargetAtTime(0, audioCtx.currentTime, 0.8);
}

function playThunder() {
  if (!audioCtx) initAudio();
  const dur = 2;
  const buf = audioCtx.createBuffer(1, audioCtx.sampleRate * dur, audioCtx.sampleRate);
  const ch = buf.getChannelData(0);
  for (let i = 0; i < ch.length; i++) {
    const t = i / audioCtx.sampleRate;
    ch[i] = (Math.random() * 2 - 1) * Math.exp(-1.5 * t) * 1.2;
  }
  const src = audioCtx.createBufferSource();
  src.buffer = buf;
  const lp = audioCtx.createBiquadFilter();
  lp.type = 'lowpass';
  lp.frequency.value = 1200;
  const gain = audioCtx.createGain();
  gain.gain.value = 0.9;
  src.connect(lp).connect(gain).connect(audioCtx.destination);
  src.start();
}

let audioUnlocked = false;
function unlockAudioOnce() {
  if (audioUnlocked) return;
  audioUnlocked = true;
  initAudio();
  window.removeEventListener('click', unlockAudioOnce);
  window.removeEventListener('touchstart', unlockAudioOnce);
}
window.addEventListener('click', unlockAudioOnce);
window.addEventListener('touchstart', unlockAudioOnce);

// ---------- Enhanced Visual Effects ----------
let activeAnimations = [];

function clearAnimations() {
  document.getElementById('clouds').innerHTML = '';
  document.getElementById('rain').innerHTML = '';
  document.getElementById('particles').innerHTML = '';
  document.getElementById('sun').style.display = 'none';
  document.getElementById('fog').style.display = 'none';
  document.getElementById('flash').style.opacity = '0';
  
  stopRain();
  stopWind();
  
  activeAnimations.forEach(timer => clearInterval(timer));
  activeAnimations = [];
}

function createEnhancedClouds(count = 5) {
  const clouds = document.getElementById('clouds');
  clouds.innerHTML = '';
  
  for (let i = 0; i < count; i++) {
    const cloud = document.createElement('div');
    cloud.className = 'cloud';
    cloud.style.top = `${10 + i * 30 + Math.random() * 20}px`;
    cloud.style.width = `${120 + Math.random() * 100}px`;
    cloud.style.height = `${60 + Math.random() * 40}px`;
    cloud.style.animationDuration = `${20 + Math.random() * 30}s`;
    cloud.style.animationDelay = `${Math.random() * 10}s`;
    cloud.style.opacity = 0.6 + Math.random() * 0.4;
    clouds.appendChild(cloud);
  }
}

function createEnhancedRain(dropCount = 200) {
  const rain = document.getElementById('rain');
  rain.innerHTML = '';
  
  for (let i = 0; i < dropCount; i++) {
    const drop = document.createElement('div');
    drop.className = 'rain-drop';
    drop.style.left = `${Math.random() * 100}%`;
    
    // Create varying raindrop sizes for realism
    const size = 0.8 + Math.random() * 1.2;
    const length = 15 + Math.random() * 25;
    drop.style.width = `${size}px`;
    drop.style.height = `${length}px`;
    
    // Natural falling speed variation
    drop.style.animationDuration = `${0.3 + Math.random() * 0.5}s`;
    drop.style.animationDelay = `${Math.random() * 2}s`;
    drop.style.opacity = 0.3 + Math.random() * 0.4;
    
    // Very subtle natural angle variation
    drop.style.transform = `rotate(${-2 + Math.random() * 4}deg)`;
    
    rain.appendChild(drop);
  }
}

function createSnow(flakeCount = 50) {
  const particles = document.getElementById('particles');
  particles.innerHTML = '';
  
  const snowflakes = ['‚ùÑ', '‚ùÖ', '‚ùÜ'];
  
  for (let i = 0; i < flakeCount; i++) {
    const flake = document.createElement('div');
    flake.className = 'snowflake';
    flake.textContent = snowflakes[Math.floor(Math.random() * snowflakes.length)];
    flake.style.left = `${Math.random() * 100}%`;
    flake.style.fontSize = `${0.8 + Math.random() * 0.8}rem`;
    flake.style.animationDuration = `${3 + Math.random() * 5}s`;
    flake.style.animationDelay = `${Math.random() * 3}s`;
    particles.appendChild(flake);
  }
}

function flashLightning() {
  const flash = document.getElementById('flash');
  
  // Initial bright flash
  const intensity = 0.4 + Math.random() * 0.6;
  flash.style.transition = 'opacity 0.02s ease';
  flash.style.opacity = intensity;
  
  // Thunder with realistic delay based on distance
  const thunderDelay = 50 + Math.random() * 800;
  if (intensity > 0.6) {
    setTimeout(() => playThunder(), thunderDelay);
  }
  
  // Realistic lightning flicker pattern
  const flickerPattern = [
    { delay: 0, opacity: intensity },
    { delay: 30, opacity: 0 },
    { delay: 60, opacity: intensity * 0.7 },
    { delay: 90, opacity: 0 },
    { delay: 120, opacity: intensity * 0.4 },
    { delay: 150, opacity: 0 },
    { delay: 200, opacity: intensity * 0.2 },
    { delay: 250, opacity: 0 }
  ];
  
  flickerPattern.forEach((flicker, index) => {
    setTimeout(() => {
      flash.style.transition = `opacity ${index === 0 ? '0.02s' : '0.01s'} ease`;
      flash.style.opacity = flicker.opacity;
    }, flicker.delay);
  });
  
  // Final fade out
  setTimeout(() => {
    flash.style.transition = 'opacity 0.3s ease';
    flash.style.opacity = '0';
  }, 300);
}

function startStorm() {
  clearAnimations();
  createEnhancedClouds(8);
  createEnhancedRain(150);
  playRain(0.7);
  playWind(0.25);
  
  const stormTimer = setInterval(() => {
    if (Math.random() < 0.6) {
      flashLightning();
    }
  }, 1000 + Math.random() * 2000);
  
  activeAnimations.push(stormTimer);
}

// ---------- Enhanced Weather Backgrounds ----------
const weatherBackgrounds = {
  clear: 'linear-gradient(135deg, #FFD89B 0%, #19547B 100%)',
  sunny: 'linear-gradient(135deg, #F093FB 0%, #F5576C 100%)',
  cloudy: 'linear-gradient(135deg, #4B79A1 0%, #283E51 100%)',
  rainy: 'linear-gradient(135deg, #0F4C75 0%, #3282B8 50%, #BBE1FA 100%)',
  stormy: 'linear-gradient(135deg, #2C3E50 0%, #4A69BD 50%, #1A1A2E 100%)',
  foggy: 'linear-gradient(135deg, #BDC3C7 0%, #2C3E50 100%)',
  snowy: 'linear-gradient(135deg, #E6DEDD 0%, #274046 100%)'
};

// ---------- Autocomplete ----------
let autoTimeout;
const input = document.getElementById('cityInput');
const suggestions = document.getElementById('suggestions');

input.addEventListener('input', () => {
  clearTimeout(autoTimeout);
  const value = input.value.trim();
  
  if (!value) {
    suggestions.style.display = 'none';
    return;
  }
  
  autoTimeout = setTimeout(async () => {
    try {
      const response = await fetch(
        `https://nominatim.openstreetmap.org/search?city=${encodeURIComponent(value)}&country=India&format=json&limit=6`
      );
      const data = await response.json();
      
      suggestions.innerHTML = '';
      
      data.forEach(item => {
        const name = (item.display_name || '').split(',')[0] || 'Unknown';
        const div = document.createElement('div');
        div.textContent = `üìç ${name}`;
        div.onclick = () => {
          input.value = name;
          suggestions.style.display = 'none';
        };
        suggestions.appendChild(div);
      });
      
      suggestions.style.display = data.length ? 'block' : 'none';
    } catch (error) {
      suggestions.style.display = 'none';
    }
  }, 400);
});

// ---------- Enhanced Weather Function ----------
async function getWeather() {
  const cityValue = input.value.trim();
  if (!cityValue) {
    input.style.borderColor = 'rgba(255, 100, 100, 0.8)';
    setTimeout(() => input.style.borderColor = 'rgba(255, 255, 255, 0.2)', 2000);
    return;
  }

  const button = document.getElementById('searchBtn');
  const originalText = button.innerHTML;
  button.innerHTML = '<span class="loading"></span> Searching...';
  button.disabled = true;

  try {
    const coordResponse = await fetch(
      `https://nominatim.openstreetmap.org/search?city=${encodeURIComponent(cityValue)}&country=India&format=json&limit=1`
    );
    const coordData = await coordResponse.json();
    
    if (!coordData.length) throw new Error('City not found in India');
    
    const { lat, lon } = coordData[0];
    const cityName = (coordData[0].display_name || '').split(',')[0] || cityValue;
    
    const weatherResponse = await fetch(
      `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=relative_humidity_2m&timezone=auto`
    );
    const weatherData = await weatherResponse.json();
    
    const current = weatherData.current_weather || {};
    const temperature = current.temperature ?? '‚Äî';
    const windSpeed = current.windspeed ?? '‚Äî';
    const weatherCode = current.weathercode ?? 0;
    const humidity = weatherData.hourly?.relative_humidity_2m?.[0] ?? '‚Äî';

    // Display results
    document.getElementById('weatherResult').style.display = 'block';
    document.getElementById('cityName').textContent = `üèôÔ∏è ${cityName}`;

    let description = "Clear";
    let background = weatherBackgrounds.clear;
    
    clearAnimations();

    // Enhanced weather conditions
    if ([0, 1].includes(weatherCode)) {
      description = "‚òÄÔ∏è Clear & Sunny";
      background = weatherBackgrounds.sunny;
      document.getElementById('sun').style.display = 'block';
    } else if ([2, 3].includes(weatherCode)) {
      description = "‚òÅÔ∏è Partly Cloudy";
      background = weatherBackgrounds.cloudy;
      createEnhancedClouds(4);
      playWind(0.03);
    } else if ([45, 48].includes(weatherCode)) {
      description = "üå´Ô∏è Foggy";
      background = weatherBackgrounds.foggy;
      document.getElementById('fog').style.display = 'block';
      createEnhancedClouds(6);
    } else if ([61, 63].includes(weatherCode)) {
      description = "üåßÔ∏è Light Rain";
      background = weatherBackgrounds.rainy;
      createEnhancedClouds(6);
      createEnhancedRain(80);
      playRain(0.4);
    } else if ([65, 80, 81, 82].includes(weatherCode)) {
      description = "üåßÔ∏è Heavy Rain";
      background = weatherBackgrounds.rainy;
      createEnhancedClouds(7);
      createEnhancedRain(120);
      playRain(0.6);
      playWind(0.2);
    } else if ([71, 73, 75, 85, 86].includes(weatherCode)) {
      description = "‚ùÑÔ∏è Snowy";
      background = weatherBackgrounds.snowy;
      createSnow(60);
      createEnhancedClouds(5);
    } else if ([95, 96, 99].includes(weatherCode)) {
      description = "‚õàÔ∏è Thunderstorm";
      background = weatherBackgrounds.stormy;
      startStorm();
    }

    document.getElementById('description').innerHTML = `<strong>${description}</strong>`;
    document.getElementById('temperature').innerHTML = `üå°Ô∏è <strong>${temperature}¬∞C</strong>`;
    document.getElementById('wind').innerHTML = `üí® Wind: <strong>${windSpeed} km/h</strong>`;
    document.getElementById('humidity').innerHTML = `üíß Humidity: <strong>${humidity}%</strong>`;
    
    document.body.style.background = background;
    suggestions.style.display = 'none';

  } catch (error) {
    alert(`‚ùå ${error.message || 'Unable to fetch weather data. Please try again.'}`);
  } finally {
    button.innerHTML = originalText;
    button.disabled = false;
  }
}

// Enhanced keyboard support
input.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') {
    getWeather();
  }
});

// Initialize AdSense
function initializeAds() {
  try {
    // Initialize all AdSense ads on the page
    (adsbygoogle = window.adsbygoogle || []).push({});
    (adsbygoogle = window.adsbygoogle || []).push({});
    (adsbygoogle = window.adsbygoogle || []).push({});
  } catch (e) {
    console.log('AdSense initialization error:', e);
  }
}

    // PWA Service Worker Registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        // Use a relative path without leading slash for Netlify
        navigator.serviceWorker.register('sw.js')
          .then(registration => {
            console.log('üöÄ SW registered:', registration);
          })
          .catch(error => console.log('‚ùå SW registration failed:', error));
      });
    }

// Initialize with a beautiful default animation and ads
window.addEventListener('load', () => {
  createEnhancedClouds(3);
  playWind(0.08);
  
  // Initialize ads after a short delay
  setTimeout(initializeAds, 1000);
});
</script>
</body>
</html>